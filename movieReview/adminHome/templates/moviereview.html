{% extends "base1.html" %} {%block title %}
<link rel="stylelogin" href="../static/css/login_register.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<title>MovieReview</title>
{% endblock %} {%block content%}
<style>

    body{
        background-color: black;
    }

    .card-link {
        color: rgb(88, 189, 247);
        text-decoration: none;
    }

    .card-link:hover {
        text-decoration: underline;
        color: rgb(88, 189, 247);
    }

    .card-link:active {
        color: rgb(47, 0, 255); /* เปลี่ยนสีลิงก์เมื่อคลิก */
    }

    .carousel-item img {
        width: 364px;
        height: 560px;
        object-fit: cover;
    }
    .divider {
    border-left: 1px solid #000; /* สีเส้นแบ่ง */
    height: 30px; /* ความสูงของเส้นแบ่ง */
    margin: 0 10px; /* ระยะห่างของเส้นแบ่งจากข้อความ */
    }

    .profile-container{
      width: 60px;
      height: 60px;
    }


    /* Star rating */


    /* .rating-box{
      position:relative;
      padding: 25px 50px 35px;

    }



    .stars i {
      color: aliceblue;
      font-size: 35px;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    .stars i.active{
      color: #ff9c1a;
    }
    .card.text-dark {
      background-color: #ffffffc8;
      border-radius: 10px;
    }

    .card.rating-box {
      background-color: #00000000;
      border: none;
    }

    .card.rating-box .stars {
      display: flex;
      justify-content: center; /* จัดตรงกลางแนวนอน */
      /*gap: 35px;  ระยะห่างระหว่างดาว 
    }*/

/* Optional: CSS for active (highlighted) stars */
    .stars i.active {
      color: gold;
    }
    .stars{
      color: rgb(255, 255, 255);
    }
    .rating-box .stars{
      display: flex;
      align-items: center;
      gap:25px;
    }
    .card.rating-box .stars i {
      flex-basis: calc(20% - 5px); /* 20% ความกว้างของแต่ละดาวและลบระยะห่างระหว่างดาวออกไป 5px */
      text-align: center;
      font-size: 24px; /* ขนาดของดาว */
    }

    @media (max-width: 768px) {
      /* ในกรณีที่หน้าจอมีขนาดเล็กกว่าหรือเท่ากับ 768px */
      .card.rating-box .stars {
        flex-wrap: wrap; /* แสดงเป็นสองแถว */
      }
    } */
    .profilecomment{
      object-fit: cover;
      object-position: center;
    }
    .submitbtn{
      height: 50%;
      width: 50%;
    }
    .checkarea{
      width: 100%;
    }
</style>
<main class="container bg-light bg-dark text-light border border-light" style="width: 120%;">

      <div class="p-4 p-md-5  text-white rounded" style="background-color: rgba(35, 35, 35, 0.879);">
        <!--รูปภาพของภาพยนตร์-->
        <div class="row">
            <div class="col-md-3" style="align-items: center; justify-content: center;">
                <div class="card" style="display: flex; height: 432px; overflow: hidden; position: relative; background: none; border: none;">
                  {% if mainmovie_image %}
                    {% if mainmovie_image.image %}
                      <img src="{{ mainmovie_image.image.url }}" alt="{{ movie.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% elif mainmovie_image.image_url %}
                      <img src="{{ mainmovie_image.image_url }}" alt="{{ movie.name }}"style="width: 100%; height: 100%; object-fit: cover;">
                    {% endif %}
                  {% endif %}
                </div>
            </div>
        <!--คลิปของภาพยนตร์-->
        <div class="col-md-7 bg-dark">
            <div class="card" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 432px; background: transparent; border-radius: 15px; overflow: hidden;">
                <div class="row text-dark" style="width: 100%; height: 432px;">
                  {% if video %}
                  <iframe id="myVideo" width="80%" height="432px" src="{{ video.video_url }}&autoplay=1&mute=1&rel=0"
                          title="{{ movie.title }}"
                          frameborder="0"
                          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                          allowfullscreen>
                  </iframe>
                  {% else %}
                  {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-2 bg-dark">
            <hr>
            <h4 style="justify-content: center; align-items: center; " class="text-center mb-2"> Movie Rate</h4>

            <!--คะแนนจากเว็บต่างๆ-->
            <div class="card" style="align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.485); border-radius: 10px;">
                <img src="https://cdn-icons-png.flaticon.com/512/5977/5977585.png" style="width: 100px; height: 60px;">
                <h5>8.1/10</h5>
            </div>
            <div class="card mt-3" style="align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.485); border-radius: 10px;">
                <img class="mt-1" src="https://cdn.cookielaw.org/logos/17e5cb00-ad90-47f5-a58d-77597d9d2c16/7e979733-6841-4fce-9182-515fac69187f/30d6331f-cc9b-43d7-a9d5-c035c834a1f9/rottentomatoes_logo_40.png" style="width: 100px; height: 40px;">
                <h5>8.1/10</h5>
            </div>
            <hr>

            <!--Tagของภาพยนตร์-->
            <div class="card bg-dark ">
                <h4 style="justify-content: center; align-items: center; " class="text-center"> Movie Tag</h4>
              {% for tags in movie.tags.all %}
                <div class="mt-1 mb-1 border-secondary card bg-transparent text-light" style="display: flex; justify-content: center; align-items: center; border-radius: 10px;">
                    <h6 class="m-0">{{ tags }}</h6>
                </div>
              {% endfor %}
              </div>
        </div>

      </div>
    </div>


    <div class="row mb-2 mt-1 ">

      <div class="col-md-8 bg-dark">
        <div class=" row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
          <div class="text-light bg-dark col p-4 d-flex flex-column position-static">

            <div class="row">
              <div class="col-md-7"></div>


                <div class="col-md-5 d-flex align-items-center mt-2">
                  <!-- Positive Comment -->
                  <svg width="20px" height="20px" viewBox="0 -0.5 21 21" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#0ef69d">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <title>like [#000000]</title>
                        <desc>Created with Sketch.</desc>
                        <defs></defs>
                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Dribbble-Light-Preview" transform="translate(-259.000000, -760.000000)" fill="#0ef69d">
                                <g id="icons" transform="translate(56.000000, 160.000000)">
                                    <path d="M203,620 L207.200006,620 L207.200006,608 L203,608 L203,620 Z M223.924431,611.355 L222.100579,617.89 C221.799228,619.131 220.638976,620 219.302324,620 L209.300009,620 L209.300009,608.021 L211.104962,601.825 C211.274012,600.775 212.223214,600 213.339366,600 C214.587817,600 215.600019,600.964 215.600019,602.153 L215.600019,608 L221.126177,608 C222.97313,608 224.340232,609.641 223.924431,611.355 L223.924431,611.355 Z" id="like-[#000000]"></path>
                                </g>
                            </g>
                        </g>
                    </g>
                  </svg>
                  <p class="mb-0 ms-3">Positive</p>
                  <strong class="d-inline-block ms-1 text-center text-light">94%</strong>
                  <div class="divider"></div>
                  <!-- Negative Comment -->
                  <svg class="mt-2 ms-2" width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                      <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                      <g id="SVGRepo_iconCarrier">
                          <path d="M15.609 5.49953V15.6595C15.609 16.0595 15.489 16.4495 15.269 16.7795L12.539 20.8395C12.109 21.4895 11.039 21.9495 10.129 21.6095C9.14904 21.2795 8.49904 20.1795 8.70904 19.1995L9.22904 15.9295C9.26904 15.6295 9.18904 15.3595 9.01904 15.1495C8.84904 14.9595 8.59904 14.8395 8.32904 14.8395H4.21904C3.42904 14.8395 2.74904 14.5195 2.34904 13.9595C1.96904 13.4195 1.89904 12.7195 2.14904 12.0095L4.60904 4.51953C4.91904 3.27953 6.26904 2.26953 7.60904 2.26953H11.509C12.179 2.26953 13.119 2.49953 13.549 2.92953L14.829 3.91953C15.319 4.29953 15.609 4.87953 15.609 5.49953Z" fill="#ff1f1f"></path>
                          <path d="M18.7894 17.6084H19.8194C21.3694 17.6084 21.9994 17.0084 21.9994 15.5284V5.47844C21.9994 3.99844 21.3694 3.39844 19.8194 3.39844H18.7894C17.2394 3.39844 16.6094 3.99844 16.6094 5.47844V15.5384C16.6094 17.0084 17.2394 17.6084 18.7894 17.6084Z" fill="#ff1f1f"></path>
                      </g>
                  </svg>
                  <p class="mb-0 ms-3">Negative</p>
                  <strong class="d-inline-block ms-1 text-center text-light">6%</strong>
                </div>
          </div>

            <!--รายละเอียดปีที่ออก เวลาของภาพยนตร์ และ เรทของภาพยนตร์ -->
            <div class="row mt-2">
              <strong class="col-md-7 d-inline-block mb-2 text-primary">
                  {{ movie.release_date.year }}
                  {{ movie.rate }}
                  {{ movie.time}}
              </strong>
            </div>

            <!-- ชื่อ ภาพยนตร์ -->
            <h3 class="mb-0">{{movie}}</h3>

            <!--วันที่ออกฉาย-->
            <div class="mb-1 text-muted">Release {{ movie.release_date }}</div>

            <!--คำอธิบายภาพยนตร์ หรือ เรื่องย่อ-->
            <p class="card-text mb-auto" style="color: rgb(177, 177, 177);">{{ movie.story }}</p>
            <hr>
            <div>

                <!-- ผู้กำกับ -->
                <div style="display: flex; flex-direction: row; align-items: center;">
                    <p class="me-3 mb-auto m-0">Director</p>
                    <a class="ms-1 me-2 card-text mb-auto m-0 card-link" href="director-link">
                        Arm Nitipat
                    </a>
                </div>
                <hr>

                <!-- คนเขียนบท -->
                <div style="display: flex; flex-direction: row; align-items: center;">
                    <p class="me-3 mb-auto m-0">Writers</p>
                    <a class="ms-1 me-2 card-text mb-auto m-0 card-link" href="writers-link">
                        Arm Nitipat
                    </a>
                </div>
                <hr>

                <!-- นักแสดง -->
                <div style="display: flex; flex-direction: row; align-items: center;">
                    <p class="me-3 mb-auto m-0">Stars</p>
                    <a class="ms-1 me-2 card-text mb-auto m-0 card-link" href="star1-link">
                        Arm Nitipat
                    </a>
                    <a class="ms-1 me-2 card-text mb-auto m-0 card-link" href="star2-link">
                        Mark Sirawit
                    </a>
                    <a class="ms-1 me-2 card-text mb-auto m-0 card-link" href="star3-link">
                        Koekae Smartdog
                    </a>
                </div>
                <hr>

                <!--Story line-->
                <!-- <div style="align-items: center;">
                    <p class="me-3 mb-auto m-0" style="font-size: 32px; font-weight: bold;">Storyline</p>
                    <p class="mt-1 mb-3" style="color: rgb(177, 177, 177);">
                        Peter Parker's secret identity is revealed to the entire world.
                        Desperate for help, Peter turns to Doctor Strange to make the world forget that he is Spider-Man.
                        The spell goes horribly wrong and shatters the multiverse, bringing in monstrous villains that could destroy the world.
                    </p>
                </div> -->


            </div>


          </div>

        </div>
      </div>
      <div class="col-md-4 bg-dark text-light">

        <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              {% for image in mainstar %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                {% if image.image %}  <!-- Assuming this is a LocalImage object with an 'image' field. -->
                  <img src="{{ image.image.url }}" class="d-block w-100" style="object-fit: cover;" alt="Image description">
                {% elif image.image_url %}  <!-- Assuming this is a URLImage object with an 'image_url' field. -->
                  <img src="{{ image.image_url }}" class="d-block w-100" style="object-fit: cover;" alt="Image description">
                {% endif %}
              </div>
            {% endfor %}
            </div>
            {% if movie_image %}
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
            {% else %}
            {% endif %}
          </div>
      </div>
      <hr class="bg-dark">
    </div>

    <div class="row g-5">
      <div class="col-md-12 justify-content-center align-items-center ">
        <h3 class="pb-4 mb-1 justify-content-center align-items-center ">
          Top Cast
        </h3>
        <hr>
        <div class="row justify-content-center align-items-center">

          <!-- รายชื่อนักแสดง -->
          {% for detail in topcast %}
          <div class="col-md-5 ms-4 mt-4 text-center" style="display: flex; align-items: center;">
            {% if topcast.main_image %}
              {% if topcast.main_image.image %}
                <img src="{{ topcast.main_image.image.url }}" alt="Main Image of {{ topcast.star.name }}" style="width: 140px; height: 140px; object-fit: cover;">
              {% elif topcast.main_image.image_url %}
                <img src="{{ topcast.main_image.image_url }}" alt="Main Image of {{ topcast.star.name }}" style="width: 140px; height: 140px; object-fit: cover;">
              {% endif %}
            {% else %}
              <p>No main image available</p>
            {% endif %}
            <div style="margin-left: 10px;">
              <h4 class="mt-2" style="font-weight: bold;">{{ detail.star.name }}</h4>
              <p style="font-size: 18px;">{{ detail.character_name }}</p>
            </div>
          </div>
        {% endfor %}
        <!--Comment-->

        <div class="container my-5 py-5 ">
          <br>
          <h3 class="pb-4 mb-1 justify-content-center text-center  align-items-center ">
            Comment Review
          </h3>
          <hr>
          <div class="mb-3 row d-flex justify-content-center">
            <!-- edit from -->
            <div class="col-md-12 col-lg-10">
              {% if user.username %}
              {% if commented %}
                <form method="post" action="{% url 'moviereview' movie.id %}" id="reviewForm" style="display: none;">
                  {% csrf_token %}
                  <div class="card text-dark mb-2" style="background-color: #ffffffe2; border-radius: 10px;" id="fromCheck">
                    <div class="card-body p-4">
                      <div class="d-flex flex-start w-100">
                        <img class="rounded-circle shadow-1-strong me-3 profilecomment"
                          src="{{ user.image.url }}" alt="avatar" width="65"
                          height="65" style="object-fit: cover;" />
                          <div class="w-100">
                            <h5>{{ user.username }}</h5>
                            <p>Give star for this movie</p>
                            
                            <div class="card rating-box justify-content-center align-items-center" style="background-color:#00000000; border: none;">
                              <div class="stars">
                                {% for i in '0123456789' %}
                                  <!-- Use data-index to store the star's index -->
                                  <i class="fa-solid fa-star" data-tooltip="{{i}} star" data-index="{{i}}" id="star{{i}}" name="score"></i>
                                {% endfor %}
                              </div>
                              <input type="hidden" id="rating" name="score" value="{{ review.score }}" minlength="1" maxlength="10">
                            </div>
                            <!-- Comments form  -->
                            <div class="form-floating mt-2">
                              <textarea class="form-control" style="height: 100px" placeholder="Leave a comment here" id="Textarea" name="data" minlength="6" maxlength="1000">{{ review.data }}</textarea>
                              <label for="Textarea">Add Comments</label>
                            </div>
                            <!-- Rating and Spoiler fields -->
                          <div class=" d-flex justify-content-between mt-3">
                            <div class=".form-check-inline checkarea" >
                              <div class="form-check">
                                <input class="form-check-input" type="radio" name="spoiler" id="nospoiler" value="0" {% if review.spoiler %}checked{% endif %}>
                                <label class="form-check-label" for="nospoiler">
                                  NO SPOILER
                                </label>
                              </div>
                              <div class="form-check">
                                <input class="form-check-input" type="radio" name="spoiler" id="spoiler" value="1" {% if review.spoiler %}checked{% endif %}>
                                <label class="form-check-label" for="spoiler">
                                  SPOILER ALERT!!
                                </label>
                              </div>
                              <div class=".form-control">
                                <div id="textinfo" class="mb-3 mt-3 " style="color: red;"></div> <!-- ส่วนแสดงข้อความเงื่อนไข -->
                              </div>
                            </div> 
                    <input type="hidden" name="comment_id" value="{{ comment.pk }}">
                    <!-- Submit button -->
                    <button type="submit" class="btn btn-primary ms-auto submitbtn" id="Send">
                      Send <i class="fas fa-long-arrow-alt-right ms-1"></i>
                    </button>
                  </div>
                </div>
                </form>
              </div>
            </div>
            {% endif %} 
            {% endif %}
          </div>
           

              <!-- Input Comment-->
              {% if user.username %}
              {% if commented %}
              {% else %}
              <form method="post" action="{% url 'moviereview' movie.id %}" id="form-check-input">
              {% csrf_token %}
              <div class="card text-dark mb-2" style="background-color: #ffffffe2; border-radius: 10px;" id="fromCheck">
                <div class="card-body p-4">
                  <div class="d-flex flex-start w-100">
                    <img class="rounded-circle shadow-1-strong me-3 profilecomment"
                      src="{{ user.image.url }}" alt="avatar" width="65"
                      height="65" style="object-fit: cover;" />
                    <div class="w-100">
                       <h5>{{ user.username }}</h5>
                      <p>Give star for this movie</p>

                        <div class="card rating-box justify-content-center align-items-center" style="background-color:#00000000; border: none;">
                          <div class="stars">
                            {% for i in '0123456789' %}
                              <!-- Use data-index to store the star's index -->
                              <i class="fa-solid fa-star" data-tooltip="{{i}} star" data-index="{{i}}" id="star{{i}}" name="score"></i>
                            {% endfor %}
                          </div>
                          <input type="hidden" id="rating" name="score" value="" minlength="1" maxlength="10">
                        </div>

                        <div class="form-floating mt-2">
                          <textarea class="form-control" style="height: 100px" placeholder="Leave a comment here" id="Textarea" name="data" minlength="6" maxlength="1000"></textarea>
                          <label for="Textarea">Add Comments</label>
                        </div>
                      <div class=" d-flex justify-content-between mt-3">
                        <div class=".form-check-inline checkarea" >
                          <div class="form-check">
                            <input class="form-check-input" type="radio" name="spoiler" id="nospoiler" value="0">
                            <label class="form-check-label" for="nospoiler">
                              NO SPOILER
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="radio" name="spoiler" id="spoiler" value="1">
                            <label class="form-check-label" for="spoiler">
                              SPOILER ALERT!!
                            </label>
                          </div>
                          <div class=".form-control">
                            <div id="textinfo" class="mb-3 mt-3 " style="color: red;"></div> <!-- ส่วนแสดงข้อความเงื่อนไข -->
                          </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary ms-auto submitbtn" id="Send">
                          Send <i class="fas fa-long-arrow-alt-right ms-1"></i>
                        </button>

                      </div>
                    </div>
                    </form>
                  </div>
                </div>
              </div>
              {% endif %}
              {% else %}
              {% endif %}

              <!--Show Comment-->
              
              <div class="card text-light " style="background-color: RGB(51,51,51); border-radius: 10px; overflow-y: scroll; max-height: 800px; color: white;">
                <div class="p-3">
                <h4 class="mb-0">Recent comments</h4>
                  <p class="fw-light">Latest Comments section by users</p>
                </div>
                
                {% if commented %}
                <div class="card-body p-4">
                  <div class="d-flex flex-start">
                    <div class="profile-container me-3">
                      <img class="rounded-circle shadow-1-strong profilecomment" src="{{ commented.user.image.url }}" alt="avatar" width="60" height="60" />
                    </div>
                    <div>
                      <h6 class="fw-bold mb-1">{{ commented.user.username }}</h6>
                      <div class="d-flex align-items-center mb-3">
                        <p class="mb-0">
                          {{ commented.update_date }}
                          <span class="badge bg-primary">Pending</span>
                        </p>
                        <!-- Editing functionality -->
                        <a href="javascript:void(0);" class="link-muted" onclick="EditForm()">
                          <i class="fas fa-pencil-alt ms-2"></i>
                        </a>
                      </div>
                      <div>
                        <div class="collapse">
                        </div>
                        <p class="mb-0">
                          {{ commented.data }}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}
                {% if other_comments %}
                  {% for comment in other_comments %}
                  <div class="card-body p-4">
                    <div class="d-flex flex-start">
                      <div class="profile-container me-3">
                        <img class="rounded-circle shadow-1-strong profilecomment" src="{{ comment.user.image.url }}" alt="avatar" width="60" height="60" />
                      </div>
                      <div>
                        <h6 class="fw-bold mb-1">{{ comment.user.username }}</h6>
                        <div class="d-flex align-items-center mb-3">
                          <p class="mb-0">
                            {{ comment.update_date }}
                            <span class="badge bg-primary">Pending</span>
                          </p>
                          <!-- Uncomment the below links if you want to provide editing functionality -->
                          <a href="" class="link-muted"><i class="fas fa-heart ms-2"></i></a>
                        </div>
                        {% if comment.spoiler %}
                        <span class="badge bg-warning text-dark">Warning: Spoilers</span>
                        <button class="btn btn-sm btn-outline-secondary ms-2" type="button" onclick="Spoiler('commentSpoiler-{{ comment.id }}')">Show Comment</button>
                        <div id="commentSpoiler-{{ comment.id }}" class="collapse">
                          <p class="mb-0">
                            {{ comment.data }}
                          </p>
                        </div>
                        {% else %}
                        <p class="mb-0">
                          {{ comment.data }}
                        </p>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                {% endif %}
                <!-- ---------------------------------------------- -->
              </div>

            </div>
          </div>
        </div>
    </div>


    <script>
    function EditForm() {
        // Example: populate the textarea and rating
        document.getElementById('Textarea').value = "{{ review.comment }}";
        document.getElementById('rating').value = "{{ review.rating }}";


        var form = document.getElementById('reviewForm');
        if (form) {
            form.style.display = 'block'; // This will make the form visible
        }
        // Set the star rating visually if using stars
          var rating = parseInt("{{ review.rating }}");
          for (var i = 0; i < rating; i++) {
              document.getElementById('star' + i).classList.add('checked');
          }

          // Handle the spoiler radio buttons
          if ("{{ review.spoiler }}" == "1") {
              document.getElementById('spoiler').checked = true;
          } else {
              document.getElementById('nospoiler').checked = true;
          }
    }

    console.log(getElementById("2"))
    // Spoiler
    function Spoiler(elementId) {
        var spoilerContent = document.getElementById(elementId);
        if (spoilerContent) {
            spoilerContent.classList.toggle('show');
        }
    }

    document.addEventListener('DOMContentLoaded', (event) => {
      const stars = document.querySelectorAll('.stars i');
      const tooltipText = document.createElement('div');
      tooltipText.classList.add('tooltip');
    document.body.appendChild(tooltipText);
      const ratingInput = document.getElementById('rating');
      const SendButton = document.getElementById('Send');
      const textareaInput = document.getElementById('Textarea');
      const spoilerInputs = document.querySelectorAll('input[name="spoiler"]');
      const errorInfo = document.getElementById('Erororinfo');
      const textinfo = document.getElementById('textinfo');

      // Rating
      stars.forEach((star, index) => {
        star.addEventListener('click', () => {
          ratingInput.value = index + 1;  // Set the rating
          highlightStars(index);
        });

        star.addEventListener('mouseenter', () => {
          highlightStars(index);
        });

        star.addEventListener('mouseleave', () => {
          highlightStars(ratingInput.value - 1);  // Reset to the current rating
        });
      });

      function highlightStars(index) {
        stars.forEach((star, idx) => {
          if (idx <= index) {
            star.classList.add('active');
          } else {
            star.classList.remove('active');
          }
        });
      }

      // Send button
      updateSendButtonStatus();

      SendButton.addEventListener('click', function(event) {
        if (!ratingInput.value || textareaInput.value.trim().length < 6 || !isSpoilerSelected(spoilerInputs)) {
          event.preventDefault();
          errorInfo.innerText = 'กรุณากรอกข้อมูลให้ครบถ้วน';
        } else {
          errorInfo.innerText = '';
        }
      });

      function updateSendButtonStatus() {
        if (!ratingInput.value || textareaInput.value.trim().length < 6 || !isSpoilerSelected(spoilerInputs)) {
          SendButton.disabled = true;
        } else {
          SendButton.disabled = false;
        }
      }

      function isSpoilerSelected(inputs) {
        for (const input of inputs) {
          if (input.checked) {
            return true;
          }
        }
        return false;
      }

      ratingInput.addEventListener('input', updateSendButtonStatus);
      textareaInput.addEventListener('input', updateSendButtonStatus);
      for (const input of spoilerInputs) {
        input.addEventListener('change', updateSendButtonStatus);
      }
    });

    </script>
  </main>
{%endblock%}
