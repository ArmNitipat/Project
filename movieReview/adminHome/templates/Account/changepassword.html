{% extends "base1.html" %}

{% block title %}
<link rel="stylesheet" href="static/login_register.css" />
<title>Change Password</title>
{% endblock %}

{% block content %}

<body class="bg-body-tertiary bg-dark">
  
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3 col-lg-2 d-flex flex-column p-3 text-white bg-dark collapse"
        style="width: 280px; height: 100vh;">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
          <svg class="bi me-2" width="40" height="32">
            <use xlink:href="#bootstrap"></use>
          </svg>
          <span class="fs-4">{{ user.username }}</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
          <li class="nav-item mb-2">
            <a href="/account" class="nav-link text-light " style="background-color: rgb(77, 75, 75);"
              aria-current="page">
              <svg class="bi me-2" width="16" height="16">
                <use xlink:href="#home"></use>
              </svg>
              My account
            </a>
          </li>
          <li class="nav-item mb-2">
            <a href="/settingprofile" class="nav-link active text-light " aria-current="page">
              <svg class="bi me-2" width="16" height="16">
                <use xlink:href="#home"></use>
              </svg>
              Profile setting
            </a>
          </li>
        </ul>
      </div>
      <!-- Main Content -->
      <div class="col-md-7 mx-auto ">
        <div class="container h-100">
          <div class="row justify-content-start bg-dark">
            <div class="card bg-dark mt-4 ">
                <main class="card-body bg-dark text-light mt-4 justify-content-center align-items-center">
                    <!-- <form method="post" id="passwordChangeForm">
                        {% csrf_token %}
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="current_password">Old password:</label>
                                <input 
                                  type="password" 
                                  name="current_password"
                                  maxlength="15" 
                                  class="form-control" 
                                  id="current_password" 
                                  required>
                                <span id="password_check_result"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="new_password">New password:</label>
                                <input 
                                  type="password"   
                                  name="new_password"
                                  maxlength="15" 
                                  class="form-control"
                                  required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="confirm_new_password">Confirm new password:</label>
                                <input 
                                  type="password"
                                  name="confirm_new_password"
                                  maxlength="15" 
                                  class="form-control"
                                  required>
                            </div>
                        </div> -->
                        <!-- {% csrf_token %}
                        <div class="row mb-3">
                          <div class="col-md-6">
                              <label for="current_password">Old password:</label>
                              <input 
                                type="password" 
                                name="current_password"
                                maxlength="15" 
                                class="form-control" 
                                id="current_password" 
                                required>
                              <span id="password_check_result"></span>
                          </div>
                      </div>
                        <div class="form-outline mb-4">
                          <label for="id_new_password1">New password:</label>
                          <input 
                            type="password" 
                            name="new_password1"
                            maxlength="15" 
                            autocomplete="new-password" 
                            required 
                            id="id_new_password1" 
                            aria-autocomplete="list"
                            class="form-control "
                            oninput="checkPassword(this)">
                        </div>
                        
                        <div class="form-outline mb-4 mt-3">
                          <label for="id_new_password2">Password confirmation:</label>
                          <input 
                            type="password" 
                            name="new_password2"
                            maxlength="15" 
                            autocomplete="new-password" 
                            required
                            id="id_new_password2"
                            aria-autocomplete="list"
                            class="form-control"
                            oninput="checkPassword(this)">
                        </div>
                        <div id="password-info" class="mb-3 mt-3" style="color: red;"></div> ส่วนแสดงข้อความเงื่อนไข -->


                        <!-- <div class="row mb-3">
                          <div id="password-info" class="mb-3 mt-3" style="color: red;"></div> 
                            <div class="col-md-6 text-danger">
                                <label id="passworderror3" style="display: none;">!!!Something wrong!!! Please check you old password. <br> New password and confirm new password will be match.</label>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                              <button id="resetPasswordButton" class="btn btn-primary" type="submit">Reset Password</button>
                            </div>
                        </div> -->
                    <!-- </form> -->
                    <form method="post" action="{% url 'changepassword' %}">
                      {% csrf_token %}
                      <div class="row">
                        <div class="col-md-6 form-outline mb-4">
                          <label for="id_old_password1">old password:</label>
                          <input 
                            type="password" 
                            name="old_password1"
                            maxlength="15" 
                            autocomplete="new-password" 
                            required 
                            id="current_password" 
                            aria-autocomplete="list"
                            class="form-control "
                            oninput="checkPassword(this)">
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6 form-outline mb-4">
                          <label for="id_new_password1">New password:</label>
                          <input 
                            type="password" 
                            name="new_password1"
                            maxlength="15" 
                            autocomplete="new-password" 
                            required 
                            id="id_new_password1" 
                            aria-autocomplete="list"
                            class="form-control "
                            oninput="checkPassword(this)">
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6 form-outline mb-4 mt-3">
                          <label for="id_new_password2">Password confirmation:</label>
                          <input 
                            type="password" 
                            name="new_password2"
                            maxlength="15" 
                            autocomplete="new-password" 
                            required
                            id="id_new_password2"
                            aria-autocomplete="list"
                            class="form-control"
                            oninput="checkPassword(this)">
                      
                      <div id="password-info" class="mb-3 mt-3" style="color: red;"></div> <!-- ส่วนแสดงข้อความเงื่อนไข -->
                    </div>
                    </div>
                    <div class="row">
                  <div class="col-md-6 d-flex justify-content-center text-center">
                    <button type="submit" class="btn btn-outline-success btn-lg mb-1 btn-hover-color" id="getUser" disabled>
                      Reset password
                  </button>
                  </div>
                </div>
                <div class="row">
                    <hr class="col-md-6 my-4">
                </div>
                  </form>
                </main>
            </div>
            {% if messages %}
            {% for message in messages %}
            <script>
              alert("{{ message }}");
            </script>
            {% endfor %}
            {% endif %}
            <script>
              function checkPassword(input) {
              const newPassword = document.getElementById('id_new_password1').value;
              const confirmPassword = document.getElementById('id_new_password2').value;
              const passwordInfo = document.getElementById('password-info');
              const passwordMatchInfo = document.getElementById('password-match-info');
              const resetPasswordButton = document.getElementById('getUser'); // ID ของปุ่ม Reset password
              const containsPersonalInfo = /your_personal_info/i.test(newPassword);
              const isCommonPassword = /common_password/i.test(newPassword);
              const isNumeric = /^\d+$/.test(newPassword);
            
              if (containsPersonalInfo) {
                passwordInfo.innerText = 'Your password can’t be too similar to your other personal information.';
                resetPasswordButton.disabled = true; // ปิดใช้งานปุ่ม
              } else if (newPassword.length < 8) {
                passwordInfo.innerText = 'Your password must contain at least 8 characters.';
                resetPasswordButton.disabled = true; // ปิดใช้งานปุ่ม
              } else if (isCommonPassword) {
                passwordInfo.innerText = 'Your password can’t be a commonly used password.';
                resetPasswordButton.disabled = true; // ปิดใช้งานปุ่ม
              } else if (isNumeric) {
                passwordInfo.innerText = 'Your password can’t be entirely numeric.';
                resetPasswordButton.disabled = true; // ปิดใช้งานปุ่ม
              } else if (newPassword !== confirmPassword) {
                passwordInfo.innerText = 'Passwords do not match.';
                resetPasswordButton.disabled = true;
              } else {
                passwordInfo.innerText = ''; // ล้างข้อความถ้ารหัสผ่านตรงกัน
                resetPasswordButton.disabled = false;
              }
            }
            </script>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
            
        </div>
    </div>
</div>
{% endblock %}